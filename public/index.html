<!DOCTYPE html>
<html lang="ru">
  <head>
    <title>Testero</title>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link href="css/bootstrap.css" rel="stylesheet" media="screen"/>
    <script src="js/jquery.js"></script>
    <script src="js/bootstrap.js"></script>
    <script> 
        $(document).ready(function() {
          $.ajax({
              type: "POST",
              url: "/login",
              success: function(data)
              {
                  if(data.status)
                  {
                      $("#login-button").attr("disabled", "disabled");
                      $("#signup-button").attr("disabled", "disabled");
                      $("#logout-button").removeAttr("disabled");
                  }
                  else
                  {
                      $("#login-button").removeAttr("disabled");
                      $("#signup-button").removeAttr("disabled");
                      $("#logout-button").attr("disabled", "disabled");
                  }
                  $("#main-menu").show();
              }
          });
          
          // Модуль signup:
          
          $("#signup-form").submit(function() {
            if ($(this).find("#email").val().length == 0)
            {
              $(this).find("#form-group-email").addClass("has-error");
              return false;
            }
            else
            {
              $(this).find("#form-group-email").removeClass("has-error");
              $(this).find("#form-group-email").addClass("has-success");
            }
            
            if ($(this).find("#password").val().length == 0)
            {
              $(this).find("#form-group-password").addClass("has-error");
              return false;
            }
            else
            {
              $(this).find("#form-group-password").removeClass("has-error");
              $(this).find("#form-group-password").addClass("has-success");
            }
            
            if ($(this).find("#password-duplicate").val().length == 0
                    || $(this).find("#password").val() != $(this).find("#password-duplicate").val())
            {
              alert("Пароли не совпали!");
              return false;
            }
            else
            {
              $.ajax({
                type: "POST",
                url: "/signup",
                data: $("#signup-form").serialize(),
                success: function(data)
                {
                  alert(data.msg);
                  if (data.status)
                  {
                    $("#logout-button").removeAttr("disabled");
                    $("#login-button").attr("disabled", "disabled");
                    $("#signup-button").attr("disabled", "disabled");
                    $("#signup").hide();
                    $("#main-menu").show();
                  }
                }
              });
            }
            return false;
          });

          // Модуль login:

          $("#login-form").submit(function() {
            $.ajax({
              type: "POST",
              url: "/login",
              data: $("#login-form").serialize(),
              success: function(data)
              {
                alert(data.msg);
                if (data.status)
                {
                  $("#logout-button").removeAttr("disabled");
                  $("#login-button").attr("disabled", "disabled");
                  $("#signup-button").attr("disabled", "disabled");
                  $("#login").hide();
                  $("#main-menu").show();
                }
              }
            });
            return false;
          });
          
          // Верхнее меню:
          
          $("#signup-button").click(function() {
            $("#signup").toggle();
          });
          
          $("#login-button").click(function() {
            $("#login").toggle();
          });
          
          $("#main-menu-button").click(function() {
            $("#main-menu").toggle();
          });
          
          $("#logout-button").click(function() {
            var url = "/logout";
            $.ajax({
              type: "POST",
              url: url,
              success: function(data){
                alert(data.msg);
                if (!data.status)
                {
                  $("#logout-button").attr("disabled","disabled");
                  $("#login-button").removeAttr("disabled");
                  $("#signup-button").removeAttr("disabled");
                }
              }
            });
          });
        }); 
    </script>
    <style>
      body { padding-top: 60px; }
    </style>
  </head>
  <body class="container-fluid">
    <header class="row">
      <nav class="navbar navbar-default navbar-fixed-top">
        <div class="container-fluid">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <span class="navbar-brand">Testero</span>
          </div>
          <div class="collapse navbar-collapse navbar-right" id="navbar-collapse">
            <ul class="nav navbar-nav">
              <li>
                <button type="button" id="main-menu-button" class="btn btn-default btn-sm navbar-btn" aria-label="" disabled="disabled">
                  <span class="glyphicon glyphicon-th" aria-hidden="true"></span> Меню
                </button>
              </li>
              <li>
                <button type="button" id="signup-button" class="btn btn-default btn-sm navbar-btn">
                  Зарегистрироваться
                </button>
              </li>
              <li>
                <button type="button" id="logout-button" class="btn btn-sm btn-default navbar-btn">
                  <span class="glyphicon glyphicon-log-out" aria-hidden="true"></span> Выйти
                </button>
              </li>
              <li>
                <button type="button" id="login-button" class="btn btn-sm btn-default btn-primary navbar-btn">
                  <span class="glyphicon glyphicon-log-in" aria-hidden="true"></span> Войти
                </button>
              </li>
            </ul>
          </div>
        </div>
      </nav>
    </header>
    
    <div id="content" class="row">
      <div id="signup" hidden>
        <div class="col-md-4"></div>
        
        <form id="signup-form" class="col-md-4">
          <h1>Регистрация в системе</h1>
          <div class="form-group has-feedback" id="form-group-email">
            <label class="control-label">Email-адрес:</label>
            <div class="input-group">
              <span class="input-group-addon">@</span>
              <input type="email" class="form-control" placeholder="Введите email"
                aria-describedly="helpBlockEmail" name="email" id="email"/>
            </div>
            <span id="helpBlockEmail" class="help-block">
              Используйте для входа в систему email-адрес, который Вы вводили при регистрации.
            </span>
          </div>
          <div class="form-group has-feedback" id="form-group-password">
            <label class="control-label">Пароль:</label>
            <input type="password" class="form-control" placeholder="Введите пароль"
                   name="password" id="password"/>
          </div>
          <div class="form-group has-feedback" id="form-group-password-duplicate">
            <label class="control-label">Пароль ещё раз:</label>
            <input type="password" class="form-control" placeholder="Введите пароль ещё раз"
              id="password-duplicate"/>
          </div>
          <input class="btn btn-large btn-primary" type="submit" value="Зарегистрироваться"/>
        </form>
        
        <div class="col-md-4"></div>
      </div>
      
      <div id="login" hidden>
        <div class="col-md-4"></div>
        
        <form id="login-form" class="col-md-4">
          <h1>Вход с систему</h1>
          <div class="form-group has-feedback">
            <label>Email-адрес:</label>
            <input type="email" class="form-control" placeholder="Введите email"
              aria-describedly="helpBlockEmail" name="email"/>
            <span id="helpBlockEmail" class="help-block">
              Используйте для входа в систему email-адрес, который Вы вводили при регистрации.
            </span>
          </div>
          <div class="form-group has-feedback">
            <label>Пароль:</label>
            <input type="password" class="form-control" placeholder="Введите пароль"
              name="password"/>
          </div>
          <div class="checkbox">
            <label>
              <input type="checkbox" value="remember-me" name="remember"/>
              Запомнить меня
            </label>
          </div>
          <input class="btn btn-large btn-primary" type="submit" value="Войти"/>
        </form>
        
        <div class="col-md-4"></div>
      </div>
      
      <!--div id="main-menu" class="row">
        <div class="col-sm-3" style="background-color: lightgray">1</div>
        <div class="col-sm-3" style="background-color: lightgray">2</div>
        <div class="col-sm-3" style="background-color: lightgray">3</div>
        <div class="col-sm-3" style="background-color: lightgray">4</div>
      </div-->
      
    </div>
    
    <footer class="row">
      <nav class="navbar navbar-default navbar-fixed-bottom" style="background: #7e7e7e;">
          <div class="navbar-header">
            <span class="navbar-brand" style="color: #dbdbdb;">
              &copy; 2015, Severe Island Team
            </span>
          </div>
      </nav>
    </footer>
  </body>
</html>
