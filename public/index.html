<!DOCTYPE html>
<html lang="ru">
  <head>
    <title>Testero</title>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link href="css/bootstrap.css" rel="stylesheet" media="screen"/>
    <script src="js/jquery.js"></script>
    <script src="js/bootstrap.js"></script>
    <script> 
        $(document).ready(function() { 
          $.ajax({
              type: "POST",
              url: "/login",
              success: function(data)
              {
                  if(data.status)
                  {
                      $("#login-button").attr("disabled", "disabled")
                      $("#logout-button").removeAttr("disabled")
                  }
                  else
                  {
                      $("#login-button").removeAttr("disabled")
                      $("#logout-button").attr("disabled", "disabled")
                  }
                  $("#main-menu").show()
                  #("#main-menu-button").removeAttr("disabled")
              }
          })
          //навешиваем коллбэк на событие отправки формы
          $("#login-form").submit(function() {
            var url = "/login"; //куда посылать
            $.ajax({
              type: "POST",
              url: url,
              data: $("#login").serialize(), //сериализация всех полей формы.
                                                  //при этом, каждый input
                                                  //должен иметь поле name!
                                                  //и желательно в name использовать
                                                  //только буквы, цифры и _.
              success: function(data)
              {
                alert(data.msg); //приём ответа
                $("#logout-button").removeAttr("disabled")
                $("#login").hide()
                $("#main-menu").show()
              }
            });
            return false; //избегание стандартного поведения формы - перехода по url
                          //а так как в <form> теге не указан конкретный адрес,
                          //то без этого return страница будет перезагружаться
          })
          $("#login-button").click(function() {
            $("#login").toggle()
          })
          $("#main-menu-button").click(function() {
            $("#main-menu").toggle()
          })
          $("#logout-button").click(function() {
            var url = "/logout";
            $.ajax({
              type: "POST",
              url: url,
              success: function(data){
                alert(data.msg);
                $("#logout-button").attr("disabled","disabled")
                $("#login").show()
                $("#main-menu").hide()
              }
            });
          });
        }); 
    </script>
    <style>
      body { padding-top: 70px; }
    </style>
  </head>
  <body class="container-fluid">
    <header class="row">
      <nav class="navbar navbar-default navbar-fixed-top">
        <div class="container-fluid">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <span class="navbar-brand">Testero</span>
          </div>
          <div class="collapse navbar-collapse navbar-right" id="navbar-collapse">
            <ul class="nav navbar-nav">
              <li>
                <button type="button" id="main-menu-button" class="btn btn-default btn-sm navbar-btn" aria-label="">
                  <span class="glyphicon glyphicon-th" aria-hidden="true"></span>
                </button>
              </li>
              <li>
                <button type="button" id="signin-button" class="btn btn-default btn-sm navbar-btn" disabled>
                  Зарегистрироваться
                </button>
              </li>
              <li>
                <button type="button" id="logout-button" class="btn btn-sm btn-default navbar-btn" disabled>
                  Выйти
                </button>
              </li>
              <li>
                <button type="button" id="login-button" class="btn btn-sm btn-default btn-primary navbar-btn" disabled>
                  Войти
                </button>
              </li>
            </ul>
          </div>
        </div>
      </nav>
    </header>
    
    <div id="content" class="row">

      <div id="login" hidden>
        <div class="col-md-4"></div>
        
        <form id="login-form" class="col-md-4">
          <h1>Вход с систему</h1>
          <div class="form-group has-feedback">
            <label>Email-адрес:</label>
            <input type="email" class="form-control" placeholder="Введите email"
              aria-describedly="helpBlockEmail" name="email"/>
            <span id="helpBlockEmail" class="help-block">
              Используйте для входа в систему email-адрес, который Вы вводили при регистрации.
            </span>
          </div>
          <div class="form-group has-feedback">
            <label>Пароль:</label>
            <input type="password" class="form-control" placeholder="Введите пароль"
              name="password"/>
          </div>
          <div class="checkbox">
            <label>
              <input type="checkbox" value="remember-me" name="remember"/>
              Запомнить меня
            </label>
          </div>
          <button class="btn btn-large btn-primary" type="submit">Войти</button>
        </form>
        
        <div class="col-md-4"></div>
      </div>
      
      <div id="main-menu" class="row">
        <div class="col-sm-3">1</div>
        <div class="col-sm-3">2</div>
        <div class="col-sm-3">3</div>
        <div class="col-sm-3">4</div>
      </div>
      
    </div>
    
    <footer>
      <p id="copyright">&copy; 2015, Severe Island Team</p>
    </footer>
  </body>
</html>
